<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#FBB040">
    <title>Sabores Urbanos - Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'brand-bg': '#EAD9BB',
              'brand-header': '#FBB040',
              'brand-card': '#F5EFE6',
              'brand-text': '#4A2C2A',
              'brand-text-light': '#6D4C41',
              'brand-accent': '#BF5700',
            }
          }
        }
      }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Roboto', sans-serif;
      }
      /* Hide scrollbar for Chrome, Safari and Opera */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      /* Hide scrollbar for IE, Edge and Firefox */
      .no-scrollbar {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.1.0",
    "react-dom/client": "https://esm.sh/react-dom@19.1.0/client",
    "react-dom": "https://esm.sh/react-dom@19.1.0",
    "react/": "https://esm.sh/react@19.1.0/",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/"
  }
}
</script>
<!-- Babel Standalone for in-browser JSX transformation -->
<script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
</head>
  <body class="bg-brand-bg">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
// Polyfills and main imports for the entire application
import React, { useState, useEffect, useRef, useCallback, StrictMode } from 'react';
import ReactDOM from 'react-dom/client';

// --- TYPE DEFINITIONS (from types.ts) ---
const Category = {
  Pizzas: 'Pizzas',
  Hamburguesas: 'Hamburguesas',
  Empanadas: 'Empanadas',
  Promos: 'Promos',
  Sanguches: 'Sánguches',
  Bebidas: 'Bebidas',
};

// --- MENU DATA (from data/menu.ts) ---
const menuItems = [
  // Pizzas
  {
    id: 1,
    name: 'Pizza Mozzarella',
    category: Category.Pizzas,
    description: 'La clásica pizza con abundante mozzarella y salsa de tomate casera.',
    price: 12500,
    ingredients: ['Masa de pizza', 'Salsa de tomate', 'Queso mozzarella', 'Aceitunas verdes', 'Orégano'],
    prepTime: '20-25 min',
    imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg'],
  },
  {
    id: 2,
    name: 'Pizza Napolitana',
    category: Category.Pizzas,
    description: 'Mozzarella, rodajas de tomate fresco y un toque de ajo y albahaca.',
    price: 13500,
    ingredients: ['Masa de pizza', 'Salsa de tomate', 'Queso mozzarella', 'Tomate fresco', 'Ajo', 'Albahaca', 'Aceitunas'],
    prepTime: '20-25 min',
    imageUrls: ['https://media.elgourmet.com/article/8metlvp345_portada-pizza.jpg'],
  },
  {
    id: 3,
    name: 'Pizza Fugazzeta',
    category: Category.Pizzas,
    description: 'Una delicia para los amantes de la cebolla, con mozzarella y un toque de aceite de oliva.',
    price: 14000,
    ingredients: ['Masa de pizza', 'Queso mozzarella', 'Cebolla blanca', 'Aceite de oliva', 'Orégano'],
    prepTime: '25-30 min',
    imageUrls: ['https://tofuu.getjusto.com/orioneat-local/resized2/8BmmxWrSsXHMr9Kpk-300-x.webp'],
  },
  {
    id: 4,
    name: 'Pizza Calabresa',
    category: Category.Pizzas,
    description: 'Sabor intenso con longaniza calabresa, mozzarella y ají molido.',
    price: 15000,
    ingredients: ['Masa de pizza', 'Salsa de tomate', 'Queso mozzarella', 'Longaniza calabresa', 'Ají molido', 'Aceitunas negras'],
    prepTime: '25-30 min',
    imageUrls: ['https://speedy.uenicdn.com/4c6d58bf-c626-4ade-85a5-5390e842a41a/c440_a/image/upload/v1612909110/business/f919def1-92cc-4aaa-906d-07447acb469b.jpg'],
  },
  // Hamburguesas
  {
    id: 5,
    name: 'Hamburguesa Clásica',
    category: Category.Hamburguesas,
    description: 'Carne de primera, lechuga, tomate y nuestra salsa especial en pan brioche.',
    price: 9500,
    ingredients: ['Carne de res', 'Pan brioche', 'Lechuga', 'Tomate', 'Cebolla', 'Salsa especial'],
    prepTime: '15-20 min',
    imageUrls: ['https://jetextramar.com/wp-content/uploads/2021/07/congelados-receta-hamburguesa-de-pollo-1024x768.jpg'],
  },
  {
    id: 6,
    name: 'Hamburguesa Doble Cheddar',
    category: Category.Hamburguesas,
    description: 'Doble medallón de carne, doble porción de queso cheddar y panceta crujiente.',
    price: 12000,
    ingredients: ['Doble carne de res', 'Pan brioche', 'Queso cheddar', 'Panceta', 'Pepinillos'],
    prepTime: '15-20 min',
    imageUrls: ['https://media-cdn.tripadvisor.com/media/photo-s/1c/c7/15/d1/holy-cheese-doble-hamburguesa.jpg'],
  },
  {
    id: 7,
    name: 'Hamburguesa Criolla',
    category: Category.Hamburguesas,
    description: 'Con provoleta grillada, morrones asados y salsa criolla.',
    price: 11500,
    ingredients: ['Carne de res', 'Pan rústico', 'Queso provoleta', 'Morrones asados', 'Huevo frito', 'Salsa criolla'],
    prepTime: '20-25 min',
    imageUrls: ['https://i.pinimg.com/1200x/03/82/15/0382153476c9ca4d2b7dfe4b69032bf7.jpg'],
  },
  {
    id: 8,
    name: 'Hamburguesa Veggie',
    category: Category.Hamburguesas,
    description: 'Medallón de lentejas y champiñones, con rúcula, tomate y mayonesa de palta.',
    price: 10500,
    ingredients: ['Medallón de lentejas', 'Pan integral', 'Rúcula', 'Tomate', 'Mayonesa de palta', 'Cebolla morada'],
    prepTime: '15-20 min',
    imageUrls: ['https://www.conasi.eu/blog/wp-content/uploads/2022/05/hamburguesa-vegana-1.jpg'],
  },
  // Empanadas
  {
    id: 9,
    name: 'Empanada de Carne Suave',
    category: Category.Empanadas,
    description: 'Relleno jugoso de carne cortada a cuchillo, con cebolla, huevo y aceitunas.',
    price: 1500,
    ingredients: ['Carne de res', 'Cebolla', 'Huevo duro', 'Aceitunas', 'Comino'],
    prepTime: '10-15 min',
    imageUrls: ['https://www.cucinare.tv/wp-content/uploads/2021/09/Empanadas-fritas-o-al-horno.jpg'],
  },
  {
    id: 10,
    name: 'Empanada de Jamón y Queso',
    category: Category.Empanadas,
    description: 'La combinación perfecta de jamón cocido y mozzarella derretida.',
    price: 1500,
    ingredients: ['Jamón cocido', 'Queso mozzarella', 'Masa de hojaldre'],
    prepTime: '10-15 min',
    imageUrls: ['https://www.clarin.com/img/2021/04/12/WYz8Yr8tB_1256x620__1.jpg'],
  },
  {
    id: 11,
    name: 'Empanada de Pollo',
    category: Category.Empanadas,
    description: 'Pollo desmenuzado en una salsa cremosa con pimientos y cebolla.',
    price: 1500,
    ingredients: ['Pollo', 'Cebolla', 'Pimiento rojo', 'Salsa blanca', 'Especias'],
    prepTime: '10-15 min',
    imageUrls: ['https://img.youtube.com/vi/mjiA5-g-Tw0/hqdefault.jpg'],
  },
   {
    id: 12,
    name: 'Empanada de Humita',
    category: Category.Empanadas,
    description: 'Dulce y cremosa, con choclo, zapallo y queso.',
    price: 1500,
    ingredients: ['Choclo', 'Zapallo', 'Queso cremoso', 'Cebolla de verdeo', 'Albahaca'],
    prepTime: '10-15 min',
    imageUrls: ['https://elsabroso.com.ar/wp-content/uploads/2024/12/empanada-humita.webp'],
  },
  // Promos
  {
    id: 13,
    name: 'Promo Pizza para 5 Personas',
    category: Category.Promos,
    description: 'Ideal para compartir. Incluye 2 pizzas de muzzarella, 1 pizza especial, gaseosa grande y postre.',
    price: 13500,
    ingredients: ['2 Pizzas grandes muzzarella (8 porciones c/u)', '1 Pizza especial (jamón y morrones o fugazzeta rellena)', '1 gaseosa de 1.5L o 2L', '1 postre helado chico (500g) o flan casero x5'],
    prepTime: '30-40 min',
    imageUrls: ['https://images.pexels.com/photos/905847/pexels-photo-905847.jpeg'],
  },
  {
    id: 14,
    name: 'Promo Empanadas para 4',
    category: Category.Promos,
    description: 'Un combo de 24 empanadas surtidas con nuestras salsitas caseras y una gaseosa grande para acompañar.',
    price: 9800,
    ingredients: ['24 empanadas surtidas (carne, pollo, jamón y queso, verdura)', '4 salsitas caseras (ají, chimichurri, criolla, etc.)', '1 gaseosa de 1.5L'],
    prepTime: '20-25 min',
    imageUrls: ['https://cuk-it.com/wp-content/uploads/2024/05/empanadas-carne-cuchillo-thumb-200x200.webp'],
  },
  {
    id: 15,
    name: 'Promo Pizza y Hamburguesas',
    category: Category.Promos,
    description: 'La combinación perfecta: 2 pizzas grandes y 4 hamburguesas completas con papas y gaseosa.',
    price: 15500,
    ingredients: ['2 Pizzas grandes (1 muzzarella + 1 especial a elección)', '4 Hamburguesas completas', '1 porción de papas grandes o 2 medianas', '1 gaseosa de 2L'],
    prepTime: '30-40 min',
    imageUrls: ['https://thumbs.dreamstime.com/b/pizza-y-hamburguesa-con-fondo-negro-vista-superior-foto-de-alta-calidad-187909343.jpg'],
  },
   {
    id: 16,
    name: 'Mega Promo 5 Hamburguesas',
    category: Category.Promos,
    description: '¡Un festín! 5 hamburguesas completas con papas fritas, salsas y gaseosa para compartir.',
    price: 11500,
    ingredients: ['5 Hamburguesas completas', '2 porciones grandes de papas fritas', '5 salsas individuales', '1 gaseosa de 2L'],
    prepTime: '25-30 min',
    imageUrls: ['https://img-global.cpcdn.com/recipes/90033ff6a172548a/640x640sq80/photo.webp'],
  },
  // Sánguches
  {
    id: 17,
    name: 'Sánguche de Milanesa Completo',
    category: Category.Sanguches,
    description: 'Milanesa de ternera, lechuga, tomate, jamón, queso y huevo frito en pan francés.',
    price: 11000,
    ingredients: ['Pan francés', 'Milanesa de ternera', 'Lechuga', 'Tomate', 'Jamón', 'Queso', 'Huevo frito'],
    prepTime: '15-20 min',
    imageUrls: ['https://www.tafiviejo.gob.ar/fotos/cache/notas/2024/10/08/830x465_241008004008_43152.jpg'],
  },
  {
    id: 18,
    name: 'Sánguche de Lomito',
    category: Category.Sanguches,
    description: 'Bife de lomo tierno, lechuga, tomate, jamón, queso, huevo y mayonesa casera.',
    price: 13000,
    ingredients: ['Pan árabe', 'Bife de lomo', 'Lechuga', 'Tomate', 'Jamón', 'Queso', 'Huevo frito', 'Mayonesa'],
    prepTime: '15-20 min',
    imageUrls: ['https://media.urgente24.com/p/0291a1f9a4afa1d606cbd25d2b9de283/adjuntos/319/imagenes/002/630/0002630803/lomito-348-pjpg.jpg'],
  },
  {
    id: 19,
    name: 'Triple Tostado',
    category: Category.Sanguches,
    description: 'Un clásico sándwich de tres capas con jamón, queso, lechuga y tomate, perfectamente tostado.',
    price: 9500,
    ingredients: ['Pan de miga triple', 'Jamón cocido', 'Queso de máquina', 'Lechuga', 'Tomate'],
    prepTime: '10-15 min',
    imageUrls: ['https://img-global.cpcdn.com/recipes/59296a703611b07c/300x426cq80/sandwich-triple-de-jamon-y-queso-foto-principal.webp'],
  },
  // Bebidas
  {
    id: 25,
    name: 'Gaseosa Línea Coca-Cola',
    category: Category.Bebidas,
    description: 'Lata de 354ml. Elige entre Coca-Cola Original, Sin Azúcar o Light.',
    price: 2000,
    ingredients: [],
    prepTime: 'N/A',
    imageUrls: ['https://latorrepizza.com.ar/wp-content/uploads/2023/03/B-GASEOSAS-min.jpg'],
  },
  {
    id: 26,
    name: 'Agua Saborizada',
    category: Category.Bebidas,
    description: 'Botella de 500ml. Sabores: Manzana, Naranja, Pomelo.',
    price: 1800,
    ingredients: [],
    prepTime: 'N/A',
    imageUrls: ['http://acdn-us.mitiendanube.com/stores/001/157/846/products/levitess-4e72e9073979c1786317062059644811-480-0.jpg'],
  },
  {
    id: 27,
    name: 'Cerveza Quilmes Clásica',
    category: Category.Bebidas,
    description: 'Lata de 473ml de la cerveza más popular de Argentina.',
    price: 3000,
    ingredients: [],
    prepTime: 'N/A',
    imageUrls: ['https://shop.gustoargentino.com/cdn/shop/files/cerveza-quilmes.png?v=1741175524&width=640'],
  },
  {
    id: 28,
    name: 'Vino Malbec (Copa)',
    category: Category.Bebidas,
    description: 'Una copa de nuestro Malbec de la casa, intenso y frutado.',
    price: 4000,
    ingredients: [],
    prepTime: 'N/A',
    imageUrls: ['https://static.wixstatic.com/media/fe24ac_06d8218106d74bcfbec02f1355b87713~mv2.webp/v1/fill/w_580,h_420,al_c,q_80,usm_0.66_1.00_0.01,enc_avif,quality_auto/fe24ac_06d8218106d74bcfbec02f1355b87713~mv2.webp'],
  },
    {
    id: 29,
    name: 'Soda / Agua con Gas',
    category: Category.Bebidas,
    description: 'Botella de 500ml.',
    price: 1500,
    ingredients: [],
    prepTime: 'N/A',
    imageUrls: ['https://acdn-us.mitiendanube.com/stores/001/147/879/products/71-bfcb6c80fd618473eb17159782074214-640-0.png'],
  },
];


// --- COMPONENTS (from components folder) ---

const Header = () => {
  return (
    <header className="bg-brand-header sticky top-0 z-40 flex-shrink-0 shadow-md">
      <div className="container mx-auto px-4 py-2 flex items-center justify-center">
         <img 
           src="https://ia600903.us.archive.org/9/items/sin-titulo-7-02/Sin%20t%C3%ADtulo-7-02.png" 
           alt="Sabores Urbanos Logo" 
           className="h-14 w-auto" 
         />
      </div>
    </header>
  );
};

const MenuItemCard = ({ item, onSelect }) => {
  return (
    <div 
      className="bg-brand-card rounded-lg shadow-md shadow-stone-400/20 hover:shadow-lg hover:shadow-brand-accent/20 transition-all duration-300 flex items-stretch cursor-pointer group overflow-hidden"
      onClick={() => onSelect(item)}
      role="button"
      aria-label={`Ver detalles de ${item.name}`}
    >
      <div className="w-1/3 flex-shrink-0">
        <img
          src={item.imageUrls[0]}
          alt={item.name}
          className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
        />
      </div>
      <div className="p-3 sm:p-4 flex flex-col flex-grow w-2/3">
        <h3 className="text-md sm:text-lg font-bold text-brand-text mb-1 truncate">{item.name}</h3>
        {item.description && <p className="text-brand-text-light text-xs sm:text-sm mb-2 flex-grow leading-tight">{item.description.substring(0, 60)}{item.description.length > 60 && '...'}</p>}
        <div className="flex justify-end items-end mt-auto">
          {item.price > 0 && <span className="text-md sm:text-lg font-bold text-brand-accent">$00.000</span>}
        </div>
      </div>
    </div>
  );
};

const CategoryIconMap = {
  'Todo': (
    <img src="https://cdn-icons-png.freepik.com/512/9725/9725767.png" alt="Todo" className="w-full h-full object-contain" />
  ),
  'Promos': (
    <img src="https://cdn-icons-png.freepik.com/512/5507/5507512.png" alt="Promos" className="w-full h-full object-contain" />
  ),
  'Pizzas': (
    <img src="https://cdn-icons-png.flaticon.com/512/1404/1404945.png" alt="Pizzas" className="w-full h-full object-contain" />
  ),
  'Hamburguesas': (
     <img src="https://cdn-icons-png.flaticon.com/512/5787/5787016.png" alt="Hamburguesas" className="w-full h-full object-contain" />
  ),
  'Empanadas': (
    <img src="https://cdn-icons-png.flaticon.com/512/6002/6002264.png" alt="Empanadas" className="w-full h-full object-contain" />
  ),
  'Sánguches': (
     <img src="https://cdn-icons-png.flaticon.com/512/3574/3574451.png" alt="Sánguches" className="w-full h-full object-contain" />
  ),
  'Bebidas': (
    <img src="https://cdn-icons-png.flaticon.com/512/1261/1261134.png" alt="Bebidas" className="w-full h-full object-contain" />
  ),
};

const CategoryNav = ({ categories, activeCategory, onCategorySelect, onToggle }) => {
  const [isOpen, setIsOpen] = useState(false);
  const buttonRef = useRef(null);
  const dropdownRef = useRef(null);
  const [dropdownTop, setDropdownTop] = useState(0);

  const setOpenState = useCallback((open) => {
    setIsOpen(open);
    onToggle(open);
  }, [onToggle]);

  const handleSelect = (category) => {
    onCategorySelect(category);
    setOpenState(false);
  };

  useEffect(() => {
    const scrollContainer = document.querySelector('.main-scroll-container');
    if (isOpen) {
      if (buttonRef.current) {
        const rect = buttonRef.current.getBoundingClientRect();
        setDropdownTop(rect.bottom + 8);
      }
      if (scrollContainer) scrollContainer.style.overflowY = 'hidden';
    } else {
      if (scrollContainer) scrollContainer.style.overflowY = 'auto';
    }
    return () => {
      if (scrollContainer) scrollContainer.style.overflowY = 'auto';
    };
  }, [isOpen]);

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (
        isOpen &&
        buttonRef.current && !buttonRef.current.contains(event.target) &&
        dropdownRef.current && !dropdownRef.current.contains(event.target)
      ) {
        setOpenState(false);
      }
    };
    document.addEventListener('mousedown', handleClickOutside);
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen, setOpenState]);

  const activeIcon = CategoryIconMap[activeCategory] || CategoryIconMap['Todo'];

  return (
    <>
      <button
        ref={buttonRef}
        onClick={() => setOpenState(!isOpen)}
        className="bg-brand-card text-brand-text font-semibold py-2 px-4 rounded-lg border border-stone-400/50 hover:border-brand-accent transition-colors duration-300 flex items-center justify-between shadow w-0 flex-1 sm:flex-none sm:w-52 text-base sm:text-lg"
        aria-haspopup="true"
        aria-expanded={isOpen}
      >
        <div className="flex items-center gap-3 min-w-0">
           <div className="w-7 h-7 rounded-full flex-shrink-0 bg-brand-accent/10 flex items-center justify-center p-1 text-brand-accent">
            {activeIcon}
           </div>
          <span className="whitespace-nowrap">{activeCategory}</span>
        </div>
        <svg className={`w-5 h-5 text-brand-text-light transition-transform duration-300 flex-shrink-0 ml-3 ${isOpen ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
      </button>

      <div
        ref={dropdownRef}
        style={{ top: dropdownTop ? `${dropdownTop}px` : '-9999px' }}
        className={`fixed left-1/2 -translate-x-1/2 w-full max-w-md z-40 px-4 transition-opacity duration-300 ease-in-out ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
        aria-hidden={!isOpen}
      >
        <div
          className={`bg-brand-card/95 backdrop-blur-sm shadow-xl rounded-lg p-4 transition-transform duration-300 ease-in-out ${isOpen ? 'translate-y-0' : '-translate-y-4'}`}
        >
          <div className="grid grid-cols-2 gap-3 sm:gap-4">
             {categories.map(cat => (
              <button
                key={cat}
                onClick={() => handleSelect(cat)}
                className={`bg-white rounded-lg aspect-video transition-all duration-300 transform hover:-translate-y-1 shadow-md hover:shadow-xl hover:shadow-brand-accent/20 focus:outline-none focus:ring-4 focus:ring-brand-accent/50 flex flex-col items-center justify-center p-2 text-center group cursor-pointer ${
                  activeCategory === cat ? 'ring-4 ring-brand-accent' : ''
                }`}
                aria-label={`Seleccionar categoría ${cat}`}
              >
                <div className="w-8 h-8 sm:w-10 sm:h-10 text-brand-accent">
                    {CategoryIconMap[cat] || CategoryIconMap['Todo']}
                </div>
                <span className="text-sm sm:text-base font-bold mt-2 text-brand-text group-hover:text-brand-accent transition-colors">{cat}</span>
              </button>
            ))}
          </div>
        </div>
      </div>
    </>
  );
};

const LocalIconMap = {
  llamar: (
    <img src="https://cdn-icons-png.freepik.com/512/3101/3101453.png" alt="Llamar" className="w-8 h-8 sm:w-10 sm:h-10 object-contain" />
  ),
  whatsapp: (
    <img src="https://cdn-icons-png.freepik.com/512/1847/1847212.png" alt="Whatsapp" className="w-8 h-8 sm:w-10 sm:h-10 object-contain" />
  ),
  ubicacion: (
    <img src="https://cdn-icons-png.freepik.com/512/5247/5247255.png" alt="Ubicación" className="w-8 h-8 sm:w-10 sm:h-10 object-contain" />
  ),
  envios: (
    <img src="https://cdn-icons-png.freepik.com/512/4454/4454464.png" alt="Envíos" className="w-8 h-8 sm:w-10 sm:h-10 object-contain" />
  ),
};

const localInfoItems = [
  {
    id: 'llamar',
    label: 'Llamar',
    description: '3644-921028',
    href: 'tel:+5493644921028',
  },
  {
    id: 'whatsapp',
    label: 'Whatsapp',
    description: '3644-921028',
    href: 'https://wa.link/z0wa6d',
    target: '_blank',
  },
  {
    id: 'ubicacion',
    label: 'Ubicación',
    description: 'Calle 38 y 19 Barrio Nuevo',
    href: 'https://maps.app.goo.gl/cUUACifa6GmWRALS7',
    target: '_blank',
  },
  {
    id: 'envios',
    label: 'Envíos',
    description: 'Consultar costo',
  },
];

const LocalMenu = ({ onToggle, onShippingClick }) => {
  const [isOpen, setIsOpen] = useState(false);
  const buttonRef = useRef(null);
  const dropdownRef = useRef(null);
  const [dropdownTop, setDropdownTop] = useState(0);

  const setOpenState = useCallback((open) => {
    setIsOpen(open);
    onToggle(open);
  }, [onToggle]);

  const handleClick = (item) => {
    setOpenState(false); 
    if (item.id === 'envios') {
      onShippingClick();
    }
  };

  useEffect(() => {
    const scrollContainer = document.querySelector('.main-scroll-container');
    if (isOpen) {
      if (buttonRef.current) {
        const rect = buttonRef.current.getBoundingClientRect();
        setDropdownTop(rect.bottom + 8);
      }
      if (scrollContainer) scrollContainer.style.overflowY = 'hidden';
    } else {
      if (scrollContainer) scrollContainer.style.overflowY = 'auto';
    }
    return () => {
      if (scrollContainer) scrollContainer.style.overflowY = 'auto';
    };
  }, [isOpen]);

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (
        isOpen &&
        buttonRef.current &&
        !buttonRef.current.contains(event.target) &&
        dropdownRef.current &&
        !dropdownRef.current.contains(event.target)
      ) {
        setOpenState(false);
      }
    };
    document.addEventListener('mousedown', handleClickOutside);
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen, setOpenState]);

  return (
    <>
      <button
        ref={buttonRef}
        onClick={() => setOpenState(!isOpen)}
        className="bg-brand-card text-brand-text font-semibold py-2 px-4 rounded-lg border border-stone-400/50 hover:border-brand-accent transition-colors duration-300 flex items-center justify-between shadow w-0 flex-1 sm:flex-none sm:w-52 text-base sm:text-lg"
        aria-haspopup="true"
        aria-expanded={isOpen}
      >
        <div className="flex items-center gap-3 min-w-0">
          <div className="w-7 h-7 rounded-full flex-shrink-0 bg-stone-200 flex items-center justify-center">
            <svg
              className="w-5 h-5 text-brand-text-light"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fillRule="evenodd"
                d="M5.05 4.05a7 7 0 119.9 9.9L10 20l-4.95-5.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"
                clipRule="evenodd"
              />
            </svg>
          </div>
          <span className="whitespace-nowrap">Nuestro Local</span>
        </div>
        <svg
          className={`w-5 h-5 text-brand-text-light transition-transform duration-300 flex-shrink-0 ml-3 ${
            isOpen ? 'rotate-180' : ''
          }`}
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      <div
        ref={dropdownRef}
        style={{ top: dropdownTop ? `${dropdownTop}px` : '-9999px' }}
        className={`fixed left-1/2 -translate-x-1/2 w-full max-w-md z-40 px-4 transition-opacity duration-300 ease-in-out ${
          isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'
        }`}
        aria-hidden={!isOpen}
      >
        <div
          className={`bg-brand-card/95 backdrop-blur-sm shadow-xl rounded-lg p-4 transition-transform duration-300 ease-in-out ${
            isOpen ? 'translate-y-0' : '-translate-y-4'
          }`}
        >
          <div className="grid grid-cols-2 gap-3 sm:gap-4">
            {localInfoItems.map((item) => {
              const commonProps = {
                key: item.id,
                onClick: () => handleClick(item),
                className:
                  'bg-white rounded-lg aspect-video transition-all duration-300 transform hover:-translate-y-1 shadow-md hover:shadow-xl hover:shadow-brand-accent/20 focus:outline-none focus:ring-4 focus:ring-brand-accent/50 flex flex-col items-center justify-center p-2 text-center group cursor-pointer',
                'aria-label': `Acceder a ${item.label}`,
              };

              const content = (
                <>
                  {LocalIconMap[item.id]}
                  <span className="text-sm sm:text-base font-bold mt-2 text-brand-text group-hover:text-brand-accent transition-colors">{item.label}</span>
                  {item.description && (
                      <span className="text-xs mt-1 whitespace-pre-line leading-tight text-brand-text-light">
                        {item.description}
                      </span>
                    )}
                </>
              );

              if (item.href) {
                return (
                  <a href={item.href} target={item.target || '_self'} rel="noopener noreferrer" {...commonProps}>
                    {content}
                  </a>
                );
              }

              return <button {...commonProps}>{content}</button>;
            })}
          </div>
        </div>
      </div>
    </>
  );
};

const ItemDetailView = ({ item, onClose }) => {
  const [currentImageIndex, setCurrentImageIndex] = useState(0);

  useEffect(() => {
    const scrollContainer = document.querySelector('.main-scroll-container');
    if (item) {
      if (scrollContainer) scrollContainer.style.overflowY = 'hidden';
      setCurrentImageIndex(0);
    } else {
      if (scrollContainer) scrollContainer.style.overflowY = 'auto';
    }
    
    const handleEsc = (event) => {
      if (event.key === 'Escape') {
        onClose();
      }
    };
    window.addEventListener('keydown', handleEsc);
    
    return () => {
      if (scrollContainer) scrollContainer.style.overflowY = 'auto';
      window.removeEventListener('keydown', handleEsc);
    };
  }, [item, onClose]);

  return (
    <div 
      className={`absolute inset-0 bg-brand-bg z-50 transform transition-transform duration-300 ease-in-out ${item ? 'translate-y-0' : 'translate-y-full'}`}
      aria-modal="true"
      role="dialog"
      aria-hidden={!item}
    >
      {item && (
        <div className="flex flex-col h-full">
          <div className="absolute top-4 left-4 z-10">
            <button 
              onClick={onClose}
              className="bg-yellow-400 text-red-500 rounded-full p-2 hover:bg-yellow-500 transition-colors shadow-lg"
              aria-label="Cerrar detalles"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>
            </button>
          </div>

          <div className="relative w-full h-2/5 flex-shrink-0 bg-stone-200">
            <img src={item.imageUrls[0]} alt={item.name} className="w-full h-full object-cover"/>
          </div>

          <div className="flex-grow overflow-y-auto p-4 sm:p-6 space-y-4 no-scrollbar">
            <div className="flex justify-between items-start">
              <h2 className="text-2xl sm:text-3xl font-bold text-brand-accent flex-1 pr-4">{item.name}</h2>
              {item.price > 0 && <p className="text-2xl sm:text-3xl font-bold text-brand-accent">$00.000</p>}
            </div>
            <p className="text-brand-text text-sm sm:text-base">{item.description}</p>
            
            {item.ingredients && item.ingredients.length > 0 && (
              <div>
                <h4 className="font-semibold text-lg text-brand-text mb-2">Ingredientes:</h4>
                <ul className="list-disc list-inside text-brand-text-light space-y-1 text-sm sm:text-base">
                  {item.ingredients.map((ing, index) => <li key={index}>{ing}</li>)}
                </ul>
              </div>
            )}
            {item.prepTime !== 'N/A' && <p className="text-sm text-brand-text-light mt-4">Tiempo de prep: <span className="font-medium text-brand-text">{item.prepTime}</span></p>}
          </div>

          <div className="flex-shrink-0 p-4 bg-brand-bg/80 backdrop-blur-sm border-t border-stone-300">
            <div className="flex items-center gap-3">
              <a
                href="tel:+5493644921028"
                className="flex-1 bg-sky-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-600 transition-colors duration-300 flex items-center justify-center gap-2 text-lg"
                aria-label="Llamar para hacer un pedido"
              >
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                Llamar
              </a>
              <a
                href={`https://wa.link/z0wa6d?text=Hola,%20quisiera%20pedir:%20${encodeURIComponent(item.name)}`}
                target="_blank"
                rel="noopener noreferrer"
                className="flex-1 bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors duration-300 flex items-center justify-center gap-2 text-lg"
                aria-label="Hacer pedido por WhatsApp"
              >
                <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.687-1.475L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.501-.183-.001-.381-.001-.579-.001-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                Hacer Pedido
              </a>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

const ShippingModal = ({ isOpen, onClose }) => {
  useEffect(() => {
    const handleEsc = (event) => {
      if (event.key === 'Escape') {
        onClose();
      }
    };
    window.addEventListener('keydown', handleEsc);
    return () => {
      window.removeEventListener('keydown', handleEsc);
    };
  }, [onClose]);

  if (!isOpen) {
    return null;
  }

  return (
    <div
      className="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 transition-opacity duration-300"
      onClick={onClose}
      role="dialog"
      aria-modal="true"
      aria-labelledby="shipping-modal-title"
    >
      <div
        className="bg-brand-card rounded-lg shadow-xl w-full max-w-sm p-6 space-y-4 transform transition-transform duration-300 scale-100 animate-in fade-in zoom-in-95"
        onClick={(e) => e.stopPropagation()}
      >
        <img 
           src="https://ia600903.us.archive.org/9/items/sin-titulo-7-02/Sin%20t%C3%ADtulo-7-02.png" 
           alt="Sabores Urbanos Logo" 
           className="h-14 w-auto mx-auto mb-4" 
         />
        <h2 id="shipping-modal-title" className="text-2xl font-bold text-brand-accent text-center mb-4">
          Costo de Envíos
        </h2>
        
        <div className="space-y-3 text-brand-text">
          <div className="flex justify-between items-center border-b border-stone-300 pb-2">
            <span className="font-semibold">Zona céntrica</span>
            <span className="font-bold text-lg text-brand-accent">$0.000</span>
          </div>
          <div className="flex justify-between items-center border-b border-stone-300 pb-2">
            <span className="font-semibold">Resto de la ciudad</span>
            <span className="font-bold text-lg text-brand-accent">$0.000</span>
          </div>
          <div className="text-center pt-2">
            <p className="font-semibold">Envíos gratis con pedidos superior a</p>
            <p className="text-xl font-bold text-brand-accent mt-1">$00.000</p>
          </div>
        </div>

        <button
          onClick={onClose}
          className="w-full mt-6 bg-red-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-600 transition-colors duration-300 focus:outline-none focus:ring-4 focus:ring-red-500/50"
          aria-label="Cerrar modal de envíos"
        >
          Cerrar
        </button>
      </div>
    </div>
  );
};

const orderedCategories = [
  Category.Promos,
  Category.Pizzas,
  Category.Hamburguesas,
  Category.Empanadas,
  Category.Sanguches,
  Category.Bebidas,
];

const MenuPage = ({ onItemSelect, onShippingClick }) => {
  const [isCategoryMenuOpen, setIsCategoryMenuOpen] = useState(false);
  const [isLocalMenuOpen, setIsLocalMenuOpen] = useState(false);
  const navCategories = ['Todo', ...orderedCategories];
  const [selectedCategory, setSelectedCategory] = useState('Todo');

  const handleCategorySelect = (category) => {
    setSelectedCategory(category);
  };

  const handleCategoryToggle = (isOpen) => {
    if (isOpen) setIsLocalMenuOpen(false);
    setIsCategoryMenuOpen(isOpen);
  };

  const handleLocalMenuToggle = (isOpen) => {
    if (isOpen) setIsCategoryMenuOpen(false);
    setIsLocalMenuOpen(isOpen);
  };

  const isDropdownOpen = isCategoryMenuOpen || isLocalMenuOpen;

  return (
    <div className="relative">
      <div className="sticky top-0 bg-brand-bg/90 backdrop-blur-sm z-30 shadow-md shadow-stone-400/20">
        <div className="container mx-auto px-4 py-3 flex items-stretch space-x-2">
          <CategoryNav
            categories={navCategories}
            activeCategory={selectedCategory}
            onCategorySelect={handleCategorySelect}
            onToggle={handleCategoryToggle}
          />
          <LocalMenu onToggle={handleLocalMenuToggle} onShippingClick={onShippingClick} />
        </div>
      </div>

      <div className={`p-2 sm:p-4 space-y-8 mt-4 transition-all duration-300 ${isDropdownOpen ? 'blur-sm pointer-events-none' : ''}`}>
        {selectedCategory === 'Todo' ? (
          orderedCategories.map(category => (
            <div key={category}>
              <div className="bg-brand-card rounded-lg py-2 px-4 mb-4 shadow-md flex items-center gap-3">
                 <div className="w-9 h-9 flex-shrink-0 p-1">
                    {CategoryIconMap[category]}
                 </div>
                 <h2 className="text-xl font-bold text-red-600 drop-shadow-[0_1px_1px_rgba(0,0,0,0.15)]">{category}</h2>
              </div>
              <div className="space-y-4">
                {menuItems
                  .filter(item => item.category === category)
                  .map(item => (
                    <MenuItemCard key={item.id} item={item} onSelect={onItemSelect} />
                ))}
              </div>
            </div>
          ))
        ) : (
          <div className="space-y-4">
            {menuItems
              .filter(item => item.category === selectedCategory)
              .map(item => (
                <MenuItemCard key={item.id} item={item} onSelect={onItemSelect} />
            ))}
          </div>
        )}
      </div>
    </div>
  );
};


// --- MAIN APP COMPONENT (from App.tsx) ---
const App = () => {
  const [selectedItem, setSelectedItem] = useState(null);
  const [isShippingModalOpen, setIsShippingModalOpen] = useState(false);

  const handleItemSelect = (item) => {
    setSelectedItem(item);
  };

  const handleCloseDetail = () => {
    setSelectedItem(null);
  };
  
  const handleOpenShippingModal = () => {
    setIsShippingModalOpen(true);
  };

  const handleCloseShippingModal = () => {
    setIsShippingModalOpen(false);
  };

  return (
    <div className="w-full max-w-md mx-auto h-screen max-h-screen overflow-hidden bg-brand-bg text-brand-text font-sans antialiased flex flex-col relative shadow-2xl shadow-stone-800/50">
      <Header />
      
      <main className="flex-grow overflow-y-auto main-scroll-container no-scrollbar">
        <MenuPage onItemSelect={handleItemSelect} onShippingClick={handleOpenShippingModal} />
      </main>
      
      <ItemDetailView item={selectedItem} onClose={handleCloseDetail} />
      
      <ShippingModal isOpen={isShippingModalOpen} onClose={handleCloseShippingModal} />
      
    </div>
  );
};


// --- APP INITIALIZATION (from index.tsx) ---
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <StrictMode>
    <App />
  </StrictMode>
);

    </script>
  </body>
</html>
